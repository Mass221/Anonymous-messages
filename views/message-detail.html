<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Message anonyme - @{{username}}</title>
  <link rel="stylesheet" href="/styles.css">
  <style>
    .message-detail-container {
      padding: 20px;
      max-width: 500px;
      margin: 0 auto;
      min-height: 100vh;
      background: #f8f9fa;
    }
    
    .message-card {
      background: linear-gradient(135deg, #e91e63 0%, #ff5722 100%);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 20px;
      color: white;
      text-align: center;
      box-shadow: 0 10px 30px rgba(233, 30, 99, 0.3);
    }
    
    .message-header {
      font-size: 1.2em;
      font-weight: 600;
      margin-bottom: 20px;
      opacity: 0.9;
    }
    
    .message-content {
      background: white;
      color: #333;
      padding: 25px;
      border-radius: 15px;
      font-size: 1.1em;
      line-height: 1.5;
      margin-bottom: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .message-time {
      font-size: 0.9em;
      opacity: 0.8;
    }
    
    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .action-btn {
      padding: 18px 25px;
      border: none;
      border-radius: 25px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .reveal-btn {
      background: linear-gradient(135deg, #e91e63, #f44336);
      color: white;
    }
    
    .reply-btn {
      background: #000;
      color: white;
    }
    
    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .reaction-section {
      background: white;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .reaction-title {
      font-size: 1.1em;
      font-weight: 600;
      margin-bottom: 15px;
      color: #333;
    }
    
    .reaction-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .reaction-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 2px solid #f0f0f0;
      background: white;
      font-size: 1.5em;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .reaction-btn:hover {
      transform: scale(1.1);
      border-color: #e91e63;
    }
    
    .reaction-btn.selected {
      border-color: #e91e63;
      background: #ffe8ed;
    }
    
    .bottom-actions {
      display: flex;
      gap: 10px;
    }
    
    .back-btn-bottom {
      flex: 1;
      padding: 15px;
      background: #6c757d;
      color: white;
      border: none;
      border-radius: 20px;
      font-weight: 600;
      cursor: pointer;
    }
    
    .share-btn {
      flex: 1;
      padding: 15px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 20px;
      font-weight: 600;
      cursor: pointer;
    }
    
    .close-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,0.2);
      color: white;
      border: none;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2em;
    }
  </style>
</head>
<body>
  <div class="message-detail-container">
    <div class="message-card">
      <button onclick="goBack()" class="close-btn">√ó</button>
      
      <div class="message-header">
        envoie-moi des messages anonymes !
      </div>
      
      <div class="message-content">
        {{messageText}}
      </div>
      
      <div class="message-time">
        Re√ßu le {{messageTime}}
      </div>
    </div>
    
    <div class="action-buttons">
      <button class="action-btn reveal-btn" onclick="showRevealPopup()">
        üëÄ Qui a envoy√© ceci ? üëÄ
      </button>
      
      <button class="action-btn reply-btn" onclick="replyToMessage()">
        üì± R√©pondre
      </button>
    </div>
    
    <div class="reaction-section">
      <div class="reaction-title">Comment tu te sens avec ce message ?</div>
      <div class="reaction-buttons">
        <button class="reaction-btn" onclick="selectReaction('üòç')" data-reaction="üòç">üòç</button>
        <button class="reaction-btn" onclick="selectReaction('üòä')" data-reaction="üòä">üòä</button>
        <button class="reaction-btn" onclick="selectReaction('üòÆ')" data-reaction="üòÆ">üòÆ</button>
        <button class="reaction-btn" onclick="selectReaction('üò¢')" data-reaction="üò¢">üò¢</button>
        <button class="reaction-btn" onclick="selectReaction('üò°')" data-reaction="üò°">üò°</button>
        <button class="reaction-btn" onclick="selectReaction('ü§î')" data-reaction="ü§î">ü§î</button>
      </div>
    </div>
    
    <div class="bottom-actions">
      <button class="back-btn-bottom" onclick="goBack()">
        ‚Üê Retour aux messages
      </button>
      <button class="share-btn" onclick="shareMessage()">
        üì§ Partager
      </button>
    </div>
  </div>

  <!-- Popup pour r√©v√©ler l'exp√©diteur -->
  <div id="revealPopup" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; align-items: center; justify-content: center;">
    <div style="background: white; padding: 30px; border-radius: 20px; text-align: center; max-width: 350px; margin: 20px;">
      <h3 style="margin-bottom: 20px;">üîí Fonction Premium</h3>
      <p style="margin-bottom: 25px; color: #666; line-height: 1.5;">
        Cette fonctionnalit√© permet de r√©v√©ler qui a envoy√© ce message anonyme.
      </p>
      <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
        <strong>Bient√¥t disponible !</strong><br>
        <small>Version premium √† venir</small>
      </div>
      <button onclick="closeRevealPopup()" style="background: #6c757d; color: white; border: none; padding: 12px 25px; border-radius: 15px; cursor: pointer;">
        Fermer
      </button>
    </div>
  </div>

  <script>
    let selectedReaction = null;

    function selectReaction(emoji) {
      // Enlever la s√©lection pr√©c√©dente
      document.querySelectorAll('.reaction-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
      
      // S√©lectionner la nouvelle r√©action
      const btn = document.querySelector(`[data-reaction="${emoji}"]`);
      btn.classList.add('selected');
      selectedReaction = emoji;
      
      // Sauvegarder la r√©action
      fetch(`/message/{{username}}/{{messageId}}/reaction`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `reaction=${emoji}`
      });
      
      // Feedback visuel
      showToast(`R√©action ${emoji} enregistr√©e !`);
    }
    
    function showRevealPopup() {
      document.getElementById('revealPopup').style.display = 'flex';
    }
    
    function closeRevealPopup() {
      document.getElementById('revealPopup').style.display = 'none';
    }
    
    function replyToMessage() {
      // Simuler une r√©ponse
      const messages = [
        "Merci pour ce message ! üòä",
        "J'ai bien re√ßu ton message anonyme !",
        "C'est gentil de ta part !",
        "Message re√ßu 5 sur 5 ! üëç"
      ];
      
      const randomMessage = messages[Math.floor(Math.random() * messages.length)];
      
      if (confirm(`Envoyer cette r√©ponse automatique ?\n\n"${randomMessage}"`)) {
        showToast("R√©ponse envoy√©e ! üì§");
        setTimeout(() => {
          goBack();
        }, 2000);
      }
    }
    
    function goBack() {
      window.location.href = '/messages/{{username}}';
    }
    
    function shareMessage() {
      const text = `Regarde ce message anonyme que j'ai re√ßu !\n\n"{{messageText}}"`;
      
      if (navigator.share) {
        navigator.share({
          title: 'Message anonyme',
          text: text
        });
      } else {
        // Fallback - copier dans le presse-papiers
        navigator.clipboard.writeText(text).then(() => {
          showToast('Message copi√© dans le presse-papiers !');
        });
      }
    }
    
    function showToast(message) {
      // Cr√©er et afficher un toast
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: #00b894;
        color: white;
        padding: 15px 25px;
        border-radius: 25px;
        z-index: 1001;
        font-weight: 600;
      `;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        document.body.removeChild(toast);
      }, 3000);
    }
    
    // Animation d'entr√©e
    document.addEventListener('DOMContentLoaded', function() {
      const card = document.querySelector('.message-card');
      card.style.opacity = '0';
      card.style.transform = 'translateY(20px)';
      card.style.transition = 'all 0.5s ease';
      
      setTimeout(() => {
        card.style.opacity = '1';
        card.style.transform = 'translateY(0)';
      }, 100);
      
      // Animation des boutons
      const buttons = document.querySelectorAll('.action-btn, .reaction-btn');
      buttons.forEach((btn, index) => {
        btn.style.opacity = '0';
        btn.style.transform = 'translateY(10px)';
        btn.style.transition = 'all 0.3s ease';
        
        setTimeout(() => {
          btn.style.opacity = '1';
          btn.style.transform = 'translateY(0)';
        }, 200 + (index * 50));
      });
    });
    
    // Gestion du swipe pour retour (mobile)
    let startX = 0;
    document.addEventListener('touchstart', function(e) {
      startX = e.touches[0].clientX;
    });
    
    document.addEventListener('touchend', function(e) {
      const endX = e.changedTouches[0].clientX;
      if (startX - endX > 100) { // Swipe gauche
        // Pas d'action pour swipe gauche
      } else if (endX - startX > 100) { // Swipe droite
        goBack();
      }
    });
  </script>
</body>
  </html>
